version: 2

models:
  - name: stg_app__customers
    description: "Staging table for customer data before transformation."
    columns:
      - name: id
        description: "The primary key for this table"
        data_tests:
          - unique
          - not_null
      - name: name
        description: "The full name of the customer"
      - name: signup_date # Corregido typo (antes singup)
        description: "The date when the customer signed up"
      - name: region
        description: "The geographical region of the customer"
    
  - name: stg_app__orders
    description: "Staging table with flattened order JSON."
    columns:
      - name: order_id
        description: "Unique identifier of the order."
        data_tests:
          - not_null
          - unique
      - name: amount_total
        description: "Total amount of the order."
        data_tests:
          - not_null
      - name: status
        description: "Status of the order."
        data_tests:
          - not_null
      - name: event_time
        description: "Timestamp"
        data_tests:
          - not_null
          # Si usasemos el paquete dbt-expectations, esta es la forma de testear recencia en un MODELO:
          # - dbt_expectations.expect_row_values_to_have_recent_data:
          #     datepart: day
          #     interval: 30
      - name: customer_identifier
        description: "Customer ID extracted from payload."
      - name: user_id
        description: "Fallback user_id."
      - name: customer_id
        description: "Resolved customer ID."
        data_tests:
          - not_null
      
  - name: stg_app_payments
    description: "Staging table for payments."
    columns:
      - name: payment_id
        description: "Unique identifier for each payment."
        data_tests:
          - not_null
          - unique
      - name: order_id
        description: "Identifier for the related order."
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_app__orders') 
              field: order_id
      - name: amount_usd
        description: "Payment amount in usd."
        data_tests:
          - not_null
      - name: status
        description: "Payment status."
        data_tests:
          - not_null
      - name: created_at
        description: "Timestamp of the payment event."
        data_tests:
          - not_null